<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VSM CANTEEN</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #4CAF50;
      color: white;
      text-align: center;
      padding: 1rem;
      font-size: 24px;
      font-weight: bold;
    }
    main {
      max-width: 700px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
    }
    input, select, button {
      display: block;
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.7rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .receipt {
      background: #eef;
      padding: 1rem;
      border: 1px dashed #333;
      margin-top: 1rem;
      white-space: pre-line;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2rem;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    .admin-section {
      display: none;
    }
    .switch-btn {
      background-color: #2196F3;
      color: white;
      border: none;
      cursor: pointer;
      padding: 0.7rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <header>VSM CANTEEN - Order System</header>
  <main>
    <button class="switch-btn" onclick="toggleAdmin()">üîÅ Switch to Admin View</button>

    <section id="user-section">
      <form onsubmit="handleOrder(event)">
        <label>Name:</label>
        <input type="text" id="name" required />
        <label>Student ID:</label>
        <input type="text" id="studentId" required />
        <label>Department:</label>
        <input type="text" id="dept" required />
        <label>Item:</label>
        <input type="text" id="item" required />
        <label>Price (‚Çπ):</label>
        <input type="number" id="price" required />
        <button type="submit">Place Order</button>
      </form>
      <div class="receipt" id="receipt" style="display: none;"></div>
    </section>

    <section id="admin-section" class="admin-section">
      <h3>Admin Panel - Orders</h3>
      <table>
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Name</th>
            <th>Student ID</th>
            <th>Dept</th>
            <th>Item</th>
            <th>Price</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody id="admin-table-body"></tbody>
      </table>
    </section>
  </main>

  <script type="module">
    // ‚úÖ Your Firebase Config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAkX15IbvwXYysyqj-RxuE8C6uTlaWYERI",
  authDomain: "vsm-canteen.firebaseapp.com",
  projectId: "vsm-canteen",
  storageBucket: "vsm-canteen.firebasestorage.app",
  messagingSenderId: "389927470639",
  appId: "1:389927470639:web:275bb13051ce3310bfa8da"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ‚úÖ Handle Order
    async function handleOrder(e) {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const id = document.getElementById("studentId").value;
      const dept = document.getElementById("dept").value;
      const item = document.getElementById("item").value;
      const price = document.getElementById("price").value;
      const time = new Date().toLocaleString();
      const orderId = "ORD" + Math.floor(Math.random() * 100000);

      const order = { orderId, name, id, dept, item, price, time };
      await addDoc(collection(db, "orders"), order);

      document.getElementById("receipt").style.display = "block";
      document.getElementById("receipt").innerText = `
üßæ VSM CANTEEN RECEIPT
-----------------------------
Order ID : ${orderId}
Name     : ${name}
Student ID: ${id}
Dept     : ${dept}
Item     : ${item}
Price    : ‚Çπ${price}
Time     : ${time}
-----------------------------
‚úÖ Show this to canteen owner.
      `;
      e.target.reset();
    }

    // ‚úÖ Toggle View
    async function toggleAdmin() {
      const user = document.getElementById("user-section");
      const admin = document.getElementById("admin-section");

      if (admin.style.display === "none") {
        admin.style.display = "block";
        user.style.display = "none";
        await fetchOrders();
      } else {
        admin.style.display = "none";
        user.style.display = "block";
      }
    }

    // ‚úÖ Fetch Orders
    async function fetchOrders() {
      const querySnapshot = await getDocs(collection(db, "orders"));
      let output = "";
      querySnapshot.forEach((doc) => {
        const o = doc.data();
        output += `
          <tr>
            <td>${o.orderId}</td>
            <td>${o.name}</td>
            <td>${o.id}</td>
            <td>${o.dept}</td>
            <td>${o.item}</td>
            <td>‚Çπ${o.price}</td>
            <td>${o.time}</td>
          </tr>`;
      });
      document.getElementById("admin-table-body").innerHTML = output;
    }
  </script>
</body>
</html>
